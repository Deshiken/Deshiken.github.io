"use strict";(self.webpackChunkboard_game_helper=self.webpackChunkboard_game_helper||[]).push([[469],{7469:(T,f,r)=>{r.r(f),r.d(f,{default:()=>P});var I,s,v,a,p,m,g=r(5861),b=r(4097),C=(r(7562),Object.defineProperty),_=(o,e,i)=>(((o,e,i)=>{e in o?C(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i})(o,"symbol"!=typeof e?e+"":e,i),i),R=(o,e,i)=>{if(!e.has(o))throw TypeError("Cannot "+i)},t=(o,e,i)=>(R(o,e,"read from private field"),i?i.call(o):e.get(o)),h=(o,e,i)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,i)},u=(o,e,i,l)=>(R(o,e,"write to private field"),l?l.call(o,i):e.set(o,i),i),c=(o,e,i,l)=>({set _(d){u(o,e,d,i)},get _(){return t(o,e,l)}});class P{constructor(e){_(this,"config"),h(this,I,void 0),_(this,"initialized",!1),h(this,s,{}),h(this,v,0),h(this,a,0),h(this,p,[]),h(this,m,void 0),_(this,"noop",()=>{}),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}initScene(e){var i=this;return(0,g.Z)(function*(){i.config=e.options,i.onInitComplete()})()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(t(this,m));const{id:i,value:l,...d}=e,n={id:i,value:l,config:d};t(this,s)[i]=n,t(this,p).push(setTimeout(()=>{this.handleAsleep(n)},c(this,v)._++*this.config.delay)),u(this,m,setTimeout(()=>{this.onRollComplete()},500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const i=t(this,s)[e.id];i.hasOwnProperty("d10Instance")&&(delete t(this,s)[i.d10Instance.id],c(this,a)._--),delete t(this,s)[e.id],c(this,a)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(t(this,s)).length&&!t(this,a)||(t(this,p).forEach(e=>clearTimeout(e)),Object.values(t(this,s)).forEach(e=>{e.mesh&&e.mesh.dispose()}),u(this,s,{}),u(this,v,0),u(this,a,0))}handleAsleep(e){var i=this;return(0,g.Z)(function*(){var l,d;if(e.asleep=!0,yield b.D.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(l=e?.d10Instance)&&l.asleep||null!=(d=e?.dieParent)&&d.asleep){const n=100===e.config.sides?e:e.dieParent,D=10===e.config.sides?e:e.d10Instance;n.value=0===D.value&&0===n.value?100:n.value+D.value,i.onRollResult({rollId:n.config.rollId,value:n.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),i.onRollResult({rollId:e.config.rollId,value:e.value});c(i,a)._++})()}}I=new WeakMap,s=new WeakMap,v=new WeakMap,a=new WeakMap,p=new WeakMap,m=new WeakMap}}]);