<div class="container">
  
  <div #savedOptionsToast class="toast fade align-items-center fixed-top" 
    data-bs-animation="true" data-bs-autohide="true" data-bs-delay="3000"
    role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        Your options have been saved.
      </div>
      <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>

  <app-heading-with-back [title]="'Descent Party Builder'"></app-heading-with-back>

  <h2 class="h5">Party Builder Options:</h2>

  <label for="partyNumberSelect">Number of Party Members:</label>
  <select [(ngModel)]="partyBuilderService.descentPartyBuilderOptions.numberOfPartyMembers" class="form-select mb-3" id="partyNumberSelect" aria-label="Default select example">
    <option [ngValue]="1">One</option>
    <option [ngValue]="2">Two</option>
    <option [ngValue]="3">Three</option>
    <option [ngValue]="4" selected>Four</option>
  </select>

  <div class="form-check">
    <input 
      [(ngModel)]="partyBuilderService.descentPartyBuilderOptions.preventRepeatClasses"
      class="form-check-input" 
      type="checkbox" 
      id="teamDraft">
    <label class="form-check-label" for="randomBuilding">
      Prevent repeat archetypes
    </label>
    <i class="bi m-3 bi-question-circle-fill" 
      data-bs-toggle="collapse" data-bs-target="#preventRepeatClassInfo" aria-expanded="false" aria-controls="balancedParty">
    </i>
  </div>
  <div class="collapse" id="preventRepeatClassInfo">
    <div class="card card-body">
      If selected, no two party members will have the same archetype (Healer, Mage, Warrior, Scout).
    </div>
  </div>

  <div class="form-check">
    <input 
      [(ngModel)]="partyBuilderService.descentPartyBuilderOptions.includeHybridClass"
      class="form-check-input" 
      type="checkbox" 
      id="teamDraft">
    <label class="form-check-label" for="randomBuilding">
      Include Hybrid Classes
    </label>
    <i class="bi m-3 bi-question-circle-fill" 
      data-bs-toggle="collapse" data-bs-target="#hybridClasses" aria-expanded="false" aria-controls="balancedParty">
    </i>
  </div>
  <div class="collapse" id="hybridClasses">
    <div class="card card-body">
      Some expansions introduced hybrid classes, which is a combination of two classes. 
      Select this option if you would like hybrid classes to be included
    </div>
  </div>

  <div class="form-check">
    <input 
      [(ngModel)]="partyBuilderService.descentPartyBuilderOptions.selectHybridSubclass"
      class="form-check-input" 
      type="checkbox" 
      id="teamDraft">
    <label class="form-check-label" for="randomBuilding">
      Randomly Select Hybrid Sub-class
    </label>
    <i class="bi m-3 bi-question-circle-fill" 
      data-bs-toggle="collapse" data-bs-target="#subClass" aria-expanded="false" aria-controls="balancedParty">
    </i>
  </div>
  <div class="collapse" id="subClass">
    <div class="card card-body">
      If you are using hybrid classes, select this to randomly choose a sub class from the content you own 
      for any hybrid classes.
    </div>
  </div>


  <h2 class="h5 mt-4">Select the Content You Own:</h2>

  <button type="button" class="btn btn-primary btn-sm me-4 my-2">
    Select All
  </button>
  <button type="button" class="btn btn-primary btn-sm my-2">
    Unselect All
  </button>

  <div class="row">
    
    <div class="col">
      <strong>Box Expansions</strong>
      <div class="form-check" *ngFor="let expansion of boxExpansions | keyvalue">
        <input class="form-check-input" type="checkbox"
          [(ngModel)]="partyBuilderService.descentPartyBuilderOptions[expansion.key]">          
        <label class="form-check-label" for="flexCheckChecked">
          {{expansion.value.name}}
        </label>

        <!-- link to expansion documentation -->           
        <a href="{{expansion.value.link}}" target="_blank">
          <i class="bi m-3 bi-link" data-bs-toggle="modal" aria-label="Download">
          </i>
        </a>
      </div>
    </div>

    <div class="col">
      <strong>Character and Monster Packs</strong>
      <div class="form-check" *ngFor="let expansion of characterAndMonsterExpansions | keyvalue">
        <input class="form-check-input" type="checkbox"
          [(ngModel)]="partyBuilderService.descentPartyBuilderOptions[expansion.key]">          
        <label class="form-check-label" for="flexCheckChecked">
          {{expansion.value.name}}
        </label>

        <!-- link to expansion documentation -->           
        <a href="{{expansion.value.link}}" target="_blank">
          <i class="bi m-3 bi-link" data-bs-toggle="modal" aria-label="Download">
          </i>
        </a>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="d-flex align-items-center">
      <button
        type="button" class="btn btn-primary btn-sm" 
        (click)="saveOptions()">
        Save My Options
      </button>
      <i class="bi bi-question-circle-fill mx-3 med-icon" 
        data-bs-toggle="collapse" data-bs-target="#optionsSave" aria-expanded="false" aria-controls="balancedParty">
      </i>
    </div>
    <div class="collapse" id="optionsSave">
      <div class="card card-body">
        Save the options and content you have selected here to your brower's cookies for future use.
      </div>
    </div>

    <div class="col">
      <button
        type="button" class="btn btn-primary mt-3"
        (click)="buildParty()">
        Build My Party
      </button>
    </div>  
  
    <ng-container *ngIf="this.selectedParty.length > 0">
      <strong class="mt-3">Selected Party</strong>
      <div class="d-flex flex-row" *ngFor="let hero of selectedParty">
        <p>Name: {{hero.name}}, Archetype: {{hero.archetype}}, Class: {{hero.class?.name}}</p>
        <span *ngIf="hero.class?.hybridArchetype">Hybrid Archetype: {{hero.class?.hybridArchetype}}</span> 
        <span *ngIf="hero.class?.hybridSubClass">Hybrid Sub Class: {{hero.class?.hybridSubClass?.name}}</span> 
      </div>
    </ng-container>
  </div>

</div>

